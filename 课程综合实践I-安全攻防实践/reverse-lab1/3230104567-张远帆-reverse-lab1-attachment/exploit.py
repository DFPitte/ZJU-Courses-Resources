import subprocess
import itertools

def try_key(key):
    try:
        # 运行challenge.elf文件，并输入秘钥
        process = subprocess.Popen('./challenge2', stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        output, error = process.communicate(input=key.encode())
        
        # 返回程序的输出
        return output.decode().strip()
    except Exception as e:
        return f"Error: {str(e)}"

def main():
    base_key = "201210242024"
    
    # 生成所有可能的四位数字组合
    for suffix in itertools.product('0123456789', repeat=4):
        full_key = base_key + ''.join(suffix)
        print(f"Trying key: {full_key}")
        
        result = try_key(full_key)
        print(f"Result: {result}")
        
        # 如果结果中包含成功的提示，则停止爆破
        if not "try" in result.lower():
            print(f"Found correct key: {full_key}")
            break
        
        print("------------------------")

if __name__ == "__main__":
    main()